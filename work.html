<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìœ¤ì„ ì˜ | YOON SUNYOUNG</title>

<!-- ì›¹í°íŠ¸ -->
<link rel="stylesheet" href="/fonts/SUIT-Variable-woff2/SUIT-Variable.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">

<!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ -->
<link rel="stylesheet" href="/style.css">
</head>
<body>

<header>
  <div class="logo">
    <div class="kr">ìœ¤ì„ ì˜</div>
    <div class="en"><p>YOON</p><p>SUNYOUNG</p></div>
  </div>
  <nav>
    <button class="menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
    <ul class="menu">
      <li class="close-menu">Ã—</li>
      <li><a href="index.html">ì²« í™”ë©´</a></li>
      <li><a href="news.html">ì†Œì‹</a></li>
      <li><a href="work.html">ì‘ì—…</a></li>
      <li><a href="about.html">ì†Œê°œ</a></li>
      <li class="lang"><a href="#" id="lang-switch" class="lang-switch"><img src="images/icon_globe.png" alt="Language" class="icon">English</a></li>
    </ul>
  </nav>
</header>

<main>
  <section class="work-list">
    <h1>ì‘ì—…</h1>

    <div class="work-categories">
      <button class="active" data-category="ì „ì²´">ì „ì²´</button>
      <button data-category="ì˜ìƒ">ì˜ìƒ</button>
      <button data-category="ë„ì„œ">ë„ì„œ</button>
      <button data-category="ê¸°íƒ€">ê¸°íƒ€</button>
    </div>

    <div class="work-container" id="work-container"></div>

    <div class="more-work" id="more-work">
      <a href="#" id="load-more">ë” ë³´ê¸°</a>
    </div>
  <section class="work-list">
</main>

<footer>
  <p>&copy; ìœ¤ì„ ì˜ YOON SUNYOUNG</p>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const workPerPage = 9;
  let currentCount = 0;
  let workData = [];
  const defaultThumb = './images/default_thumbnail.jpg';

  const container = document.getElementById('work-container');
  const moreBtn = document.getElementById('more-work');
  const loadMoreLink = document.getElementById('load-more');

  // JSON ë¶ˆëŸ¬ì˜¤ê¸°
  fetch('work.json')
    .then(res => res.json())
    .then(data => {
      workData = data.sort((a, b) => new Date(b.date) - new Date(a.date));
      renderWork();
    }).catch(err => {
      console.error("work.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
      container.innerHTML = '<p>ì‘ì—… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    });

  function checkImage(url, callback){
    const img = new Image();
    img.onload = () => callback(true);
    img.onerror = () => callback(false);
    img.src = url;
  }

  function renderWork(category='ì „ì²´') {
    container.innerHTML = '';
    const filtered = category === 'ì „ì²´' ? workData : workData.filter(item => item.category === category);
    const toShow = filtered.slice(0, currentCount + workPerPage);

    toShow.forEach(item => {
      const div = document.createElement('div');
      div.className = 'work-item';
      div.onclick = () => window.location.href=`work_detail.html?id=${item.id}`;

      const thumb = document.createElement('div');
      thumb.className = 'thumbnail';

      checkImage(item.thumbnail, exists => {
        if(exists){
          thumb.style.backgroundImage = `url('${item.thumbnail}')`;
        } else {
          thumb.style.backgroundImage = `url('${defaultThumb}')`;
        }
      });

      const info = document.createElement('div');
      info.className = 'work-info';

      const cat = document.createElement('span');
      cat.className = 'category';
      cat.textContent = item.category;

      const title = document.createElement('span');
      title.className = 'title';
      title.textContent = item.title;

      info.appendChild(cat);
      info.appendChild(title);

      div.appendChild(thumb);
      div.appendChild(info);

      container.appendChild(div);
    });

    currentCount = toShow.length;

    // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
    loadMoreLink.onclick = null;

    // ìŠ¤í¬ë¡¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    const contentOverflows = container.scrollHeight > window.innerHeight;

    // ë²„íŠ¼ ì¡°ê±´ ì²˜ë¦¬
    if(currentCount < filtered.length){
      // ë‚¨ì€ ë°ì´í„°ê°€ ìˆìœ¼ë©´ "ë” ë³´ê¸°"
      loadMoreLink.style.display = 'inline-block';
      loadMoreLink.textContent = "ğŸ¡» ë” ë³´ê¸°";
      loadMoreLink.onclick = (e) => {
        e.preventDefault();
        renderWork(category);
      };
    } else if(currentCount >= filtered.length && contentOverflows){
      // ëª¨ë“  ë°ì´í„°ë¥¼ ë‹¤ ë¶ˆëŸ¬ì™”ê³  ìŠ¤í¬ë¡¤ì´ ìˆìœ¼ë©´ "ìœ„ë¡œê°€ê¸°"
      loadMoreLink.style.display = 'inline-block';
      loadMoreLink.textContent = "ğŸ¡¹ ìœ„ë¡œ ê°€ê¸°";
      loadMoreLink.onclick = (e) => {
        e.preventDefault();
        container.scrollIntoView({ behavior: "smooth", block: "start" });
      };
    } else {
      // ëª¨ë“  ë°ì´í„°ë¥¼ ë‹¤ ë¶ˆëŸ¬ì™”ê³  ìŠ¤í¬ë¡¤ë„ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
      loadMoreLink.style.display = 'none';
    }
  }

  // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
  document.querySelectorAll('.work-categories button').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('.work-categories button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentCount = 0;
      renderWork(btn.dataset.category);
    });
  });

  // ëª¨ë°”ì¼ ë©”ë‰´
  const menuToggle = document.querySelector('.menu-toggle');
  const menu = document.querySelector('.menu');
  const closeMenuBtn = document.querySelector('.close-menu');

  menuToggle.addEventListener('click', ()=>menu.classList.toggle('active'));
  closeMenuBtn.addEventListener('click', ()=>menu.classList.remove('active'));
  document.addEventListener('click', e=>{
    const isClickInside = menu.contains(e.target) || menuToggle.contains(e.target);
    if(!isClickInside && menu.classList.contains('active')) menu.classList.remove('active');
  });
  // ------------------------------
  // ì–¸ì–´ ì „í™˜ ë²„íŠ¼ ì²˜ë¦¬
  // ------------------------------
  const langSwitchBtns = document.querySelectorAll('.lang-switch');

  langSwitchBtns.forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();

      const path = window.location.pathname;  // í˜„ì¬ ê²½ë¡œ
      const search = window.location.search;  // ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ?id=13 ë“±
      const fileName = path.split('/').pop(); // index.html, about.html ë“±

      let targetPath = '';

      // í˜„ì¬ í˜ì´ì§€ê°€ ì˜ì–´(/en/)ì¸ì§€ í™•ì¸
      if (path.includes('/en/')) {
        // ì˜ì–´ â†’ í•œêµ­ì–´: í•œ ë‹¨ê³„ ìœ„ë¡œ ì´ë™
        targetPath = '../' + fileName;
      } else {
        // í•œêµ­ì–´ â†’ ì˜ì–´: en/ í´ë” ì•„ë˜ë¡œ ì´ë™
        targetPath = 'en/' + fileName;
      }

      window.location.href = targetPath + search;
    });
  });
});
</script>


</body>
</html>
